<!DOCTYPE html>
<html lang="zh-cn" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices --> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    	
    <meta name="generator" content="Hugo 0.37.1" />
    
    <title>Debugging Go Code with GDB [è¯‘] &middot; CZKit</title>
    <meta content="Debugging Go Code with GDB [è¯‘] - CZKit" property="og:title">
    <meta content=" - å½“åœ¨Linux/Mac OS X/FreeBSD æˆ–è€…NetBSDç­‰ç³»ç»Ÿä¸Šé€šè¿‡gcå·¥å…·é“¾ç¼–è¯‘Goç¨‹åºæ„å»ºå‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«äº† DWARFv4 è°ƒè¯•ä¿¡æ¯å¯ä»¥ç”¨äºGDB(éœ€è¦ç‰ˆæœ¬å¤§äºç­‰äº7.5ï¼‰è°ƒè¯•ä¸€ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹æˆ–è€…Coreæ–‡ä»¶ã€‚" property="og:description">    
    <!-- CSS --> 
    <link rel="stylesheet" href="http://www.czkit.com/css/print.css" media="print">
    <link rel="stylesheet" href="http://www.czkit.com/css/poole.css">
    <link rel="stylesheet" href="http://www.czkit.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,500">
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    
    <!-- Customised CSS -->
    <link rel="stylesheet" href="http://www.czkit.com/css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

	</head>
    <body>
        <div class="sidebar">
	<div class="container text-center sidebar-sticky">
		<div class="sidebar-about text-center">			
			 <img src="/images/logo.png" alt="Author Image" class="img-circle headshot center"> 
			<a href="http://www.czkit.com/"><h1 class="brand">CZKit</h1></a>
			<p class="lead">
				 Game &amp; Golang 
			</p>
		</div>
		
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/posts/"> <span>Posts</span></a>
				</li>
				<li>
					<a href="/categories/"> <span>Category</span></a>
				</li>
				<li>
					<a href="/tags/"> <span>Tags</span></a>
				</li>
				<li>
					<a href="/about.html"> <span>About</span></a>
				</li>
		</li>
	</ul>
</div>

        <p>
		<section class="row text-center">
	
	
	
	&nbsp;<a href="https://github.com/cz-it"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
</section>

        </p>
		<p class="copyright">&copy; 2018 CZ
        <a href="https://creativecommons.org/licenses/by/4.0"> &copy CZKit.com </a>.<br/>Built with <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
        </p>
	</div>
	<div>
	</div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Debugging Go Code with GDB [è¯‘]</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       <i class="fa fa-calendar" aria-hidden="true"></i> 8046-04-08 
      
      
        
        
            in
            
            
                <a class="meta" href="/categories/golang">GOLANG</a>
                
            
        
      
      
      
        
        
            <br/>
             <i class="fa fa-tags" aria-hidden="true"></i>
            
            <a class="meta" href="/tags/debug">debug</a> 
        
            <a class="meta" href="/tags/gdb">gdb</a> 
        
            <a class="meta" href="/tags/golang">golang</a>
        
      
      
      </span>  
  </div>    
  
  <blockquote>
<p>ä¸€ç¯‡å¾ˆè€çš„æ–‡ç« ï¼Œæœ€è¿‘ç¿»æ¥çœ‹ï¼Œå¥½åƒä¹Ÿæ²¡äººç¿»è¯‘ï¼Œéšæ‰‹ç¿»è¯‘ä¸€éï¼Œæ–‡ç« æ¥è‡ª<a href="https://golang.google.cn/doc/gdb">Golang&rsquo;s Blog</a></p>
</blockquote>

<p>ä»¥ä¸‹è¯´æ˜é€‚ç”¨äºGolangçš„æ ‡å‡†å·¥å…·é“¾ï¼ˆGoç¼–è¯‘å™¨å¦‚gcä»¥åŠå…¶ä»–å·¥å…·ï¼‰ï¼ŒGccGoæœ‰ä»–è‡ªå·±çš„gdbæ”¯æŒã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºä½¿ç”¨æ ‡å‡†å·¥å…·é“¾æ„å»ºçš„Golangæ¥è¯´<a href="https://github.com/derekparker/delve">Delve</a>ç›¸æ¯”å¦‚GDBæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼ŒDelveå¯ä»¥æ›´å¥½çš„ç†è§£Goçš„è¿è¡Œæ—¶ã€æ•°æ®ç»“æ„ä»¥åŠè¡¨è¾¾å¼ç­‰ã€‚å½“å‰Delveå¯ä»¥æ”¯æŒLinuxã€OSXä»¥åŠarm64å¹³å°ä¸‹çš„Windowsï¼Œæœ€æ–°èƒ½æ”¯æŒçš„å¹³å°åˆ—è¡¨å‚è§<a href="https://github.com/derekparker/delve/tree/master/Documentation/installation">Delveçš„æ–‡æ¡£</a></p>

<p>GDBå¹¶ä¸èƒ½å¾ˆå¥½ç†è§£Goç¨‹åºï¼Œæ¯”å¦‚æ ˆç®¡ç†ã€çº¿ç¨‹ä»¥åŠåŒ…å«äº†å’Œä¼ ç»ŸGDBæ‰§è¡Œæ¨¡å‹ä¸ä¸€æ ·çš„è¿è¡Œæ—¶ï¼Œå³ä¾¿æ˜¯é€šè¿‡gccgoæ¥ç¼–è¯‘çš„ç¨‹åºæœ‰æ—¶å€™ä¹Ÿä¼šäº§ç”Ÿè®©äººè¿·æƒ‘çš„ä¿¡æ¯ã€‚æ€»çš„æ¥è¯´ï¼Œè™½ç„¶GDBå¯ä»¥åœ¨ä¸€äº›åœºæ™¯ï¼ˆå¦‚è°ƒè¯•Cgoä»£ç æˆ–è€…è°ƒè¯•è¿è¡Œæ—¶ï¼‰èµ·åˆ°å®šä½é—®é¢˜çš„ä½œç”¨ï¼Œä½†å®ƒä¸æ˜¯Goèµ–ä»¥ç”Ÿå­˜çš„è°ƒè¯•å™¨ï¼Œå°¤å…¶æ˜¯å¯¹äºå¹¶å‘åœºæ™¯ã€‚æˆ–è€…è¯´GDBä¸æ˜¯Goç¨‹åºé¦–é€‰çš„è°ƒè¯•å™¨ã€‚</p>

<p></p>

<p>æ‰€ä»¥ï¼Œä¸‹é¢çš„ç¯‡å¹…åªæ˜¯å½“ä½ ç”¨GDBæ—¶å€™çš„ä¸€ä¸ªæŒ‡å¼•ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šæˆåŠŸã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å‚è€ƒ<a href="https://sourceware.org/gdb/current/onlinedocs/gdb/">GDBæ‰‹å†Œ</a></p>

<h2 id="ç®€ä»‹">ç®€ä»‹</h2>

<p>å½“åœ¨Linux/Mac OS X/FreeBSD æˆ–è€…NetBSDç­‰ç³»ç»Ÿä¸Šé€šè¿‡gcå·¥å…·é“¾ç¼–è¯‘Goç¨‹åºæ„å»ºå‡ºæ¥çš„äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«äº† DWARFv4 è°ƒè¯•ä¿¡æ¯å¯ä»¥ç”¨äºGDB(éœ€è¦ç‰ˆæœ¬å¤§äºç­‰äº7.5ï¼‰è°ƒè¯•ä¸€ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹æˆ–è€…Coreæ–‡ä»¶ã€‚</p>

<p>åœ¨è¿æ¥çš„æ—¶å€™ï¼Œå¯ä»¥ä¼ é€’&rdquo;-w&rdquo;é€‰é¡¹æ¥çœç•¥è°ƒè¯•ä¿¡æ¯ï¼ˆä¸¾ä¾‹ï¼šgo build -ldflags=-w prog.goï¼‰ã€‚</p>

<p>gcç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç åœ¨æ¯ä¸€è¡ŒåŒ…å«äº†å‡½æ•°çš„è°ƒç”¨å’Œæ³¨å†Œè¡¨ä¿¡æ¯ï¼Œè¿™äº›é€‰é¡¹æœ‰æ—¶å€™ä¼šä½¿å¾—é€šè¿‡gdbè°ƒè¯•èµ·æ¥å˜å¾—å›°éš¾ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦å»é™¤è¿™äº›ä¼˜åŒ–çš„è¯ï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶ä½¿ç”¨<code>go build -gcflags=all=&quot;-N -l&quot;.</code></p>

<p>å¦‚æœæƒ³é€šè¿‡GDBè°ƒè¯•ä¸€ä¸ªç¨‹åºçš„coreæ–‡ä»¶ï¼Œéœ€è¦åœ¨ç¨‹åºå´©æºƒçš„æ—¶å€™è§¦å‘ç”Ÿæˆä¸€ä¸ªdumpæ–‡ä»¶ï¼Œæ­¤æ—¶éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡<code>GOTRACEBACK=crash</code>ï¼ˆæ›´å¤šä¿¡æ¯å‚è€ƒ<a href="https://golang.google.cn/pkg/runtime/#hdr-Environment_Variables">runtime package documentation</a>ï¼‰ã€‚</p>

<h2 id="ä¸€èˆ¬æ“ä½œ">ä¸€èˆ¬æ“ä½œ</h2>

<ul>
<li><p>æ˜¾ç¤ºæ–‡ä»¶ä»£ç æˆ–æŒ‡å®šè¡Œå·ä»£ç å¹¶è®¾ç½®å’Œå–æ¶ˆæ–­ç‚¹ï¼š</p>

<pre><code>(gdb) list
(gdb) list line
(gdb) list file.go:line
(gdb) break line
(gdb) break file.go:line
(gdb) disas
</code></pre></li>

<li><p>æ˜¾ç¤ºæ–­ç‚¹å’Œæ ˆä¿¡æ¯</p>

<pre><code>(gdb) bt
(gdb) frame n
</code></pre></li>

<li><p>åœ¨æ ˆå¸§ä¸­æ˜¾ç¤ºæœ¬åœ°å˜é‡ã€å‚æ•°ã€è¿”å›å€¼çš„åç§°ã€ç±»å‹ä½ç½®ç­‰</p>

<pre><code>(gdb) info locals
(gdb) info args
(gdb) p variable
(gdb) whatis variable
</code></pre></li>

<li><p>æ˜¾ç¤ºå…¨å±€å˜é‡çš„åç§°ã€ç±»å‹å’Œä½ç½®</p>

<pre><code>(gdb) info variables regexp
</code></pre></li>
</ul>

<h2 id="goæ‰©å±•">Goæ‰©å±•</h2>

<p>GDBæœ€æ–°çš„æ‰©å±•æœºåˆ¶å¯ä»¥è®©å®ƒåŠ è½½æŒ‡å®šäºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æ‰©å±•è„šæœ¬ã€‚å·¥å…·é“¾é€šè¿‡è¿™ä¸ªæ–¹æ³•æ‰©å±•äº†GDBæ¥æ”¯æŒä¸€äº›è°ƒè¯•è¿è¡Œæ—¶ï¼ˆæ¯”å¦‚Goroutine)ä»¥åŠæ‰“å°å†…å»ºçš„map/sliceä»¥åŠchannelç±»å‹çš„å‘½ä»¤ã€‚</p>

<ul>
<li><p>æ‰“å°string/slice/map/channel æˆ–æ¥å£</p>

<pre><code>(gdb) p var
</code></pre></li>

<li><p>æ±‚string/slice/mapçš„&rdquo;len&rdquo;å’Œ&rdquo;cap()&ldquo;å‡½æ•°</p>

<pre><code>(gdb) p $len(var)
</code></pre></li>

<li><p>åŠ¨æ€å°†æ¥å£è½¬æ¢ä¸ºå…¶ä»–ç±»å‹å‡½æ•°</p>

<pre><code>(gdb) p $dtype(var)
(gdb) iface var
</code></pre></li>
</ul>

<blockquote>
<p>å¦‚æœæ¥å£çš„é•¿åç§°ä¸åŒäºçŸ­åç§°ï¼ŒGDBå°±æ— æ³•åŠ¨æ€çš„æ‰¾åˆ°æ¥å£å€¼çš„ç±»å‹ã€‚</p>
</blockquote>

<ul>
<li><p>æŸ¥çœ‹goroutines:</p>

<pre><code>(gdb) info goroutines
(gdb) goroutine n cmd
(gdb) help goroutine
</code></pre></li>
</ul>

<p>ä¾‹å­ï¼š</p>

<pre><code>    (gdb) goroutine 12 bt
</code></pre>

<p>å¦‚æœæƒ³æ¢å¯»å…¶å·¥ä½œæµç¨‹ï¼Œæˆ–è€…æƒ³æ‰©å±•çš„è¯ï¼Œå¯ä»¥æŸ¥çœ‹Goæºç ç›®å½•ä¸­çš„&rdquo;src/runtime/runtime-gdb.py&rdquo;ã€‚è¿™é‡Œçš„è„šæœ¬ä¾èµ–äº†ä¸€äº›è¿æ¥å™¨ï¼ˆsrc/cmd/link/internal/ld/dwarf.goï¼‰åœ¨DWARFä¸­ä¿ç•™çš„ ç‰¹æ®Šçš„é­”æ•°ç±»å‹(hash<T,U>) å’Œå˜é‡ã€‚</p>

<p>å¦‚æœæƒ³äº†è§£debugä¿¡æ¯é•¿ä»€ä¹ˆæ ·ã€‚å¯ä»¥é€šè¿‡è¿è¡Œ<code>objdump -W a.out</code> å¹¶æµè§ˆ &ldquo;.debug_*&ldquo;æ®µã€‚</p>

<h3 id="å…³é”®ç‚¹">å…³é”®ç‚¹</h3>

<ol>
<li>è¿™é‡Œçš„å®Œç¾æ‰“å°åªèƒ½æ‰“å°stringï¼Œä½†æ˜¯ç»§æ‰¿ä¸stringçš„ç±»å‹ä¸è¡Œ</li>
<li>Runtimeé‡Œé¢Cçš„ç±»å‹ä¿¡æ¯æ˜¯æ²¡æœ‰çš„</li>
<li>GDBæ— æ³•å®Œå…¨ç†è§£Goçš„åç§°ï¼Œå¹¶å°†&rdquo;fmt.Print&rdquo;ç†è§£æˆéœ€è¦ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„éç»“æ„åŒ–å­—ç¬¦ä¸²ï¼Œå¯¹äºç±»ä¼¼&rdquo;pkg.(*MyType).Meth&rdquo;è¿™ç§çš„å°±æ›´éš¾ç†è§£äº†ã€‚</li>
<li>æ‰€æœ‰çš„å…¨å±€å¯¹è±¡éƒ½åœ¨&rdquo;main&rdquo;åŒ…é‡Œé¢</li>
</ol>

<h2 id="æ•™ç¨‹">æ•™ç¨‹</h2>

<p>åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è°ƒè¯•&rdquo;<a href="https://golang.google.cn/pkg/regexp/">regexp</a>&ldquo;åŒ…ä¸­çš„æµ‹è¯•ç¨‹åºã€‚é¦–å…ˆå»åˆ°&rdquo;$GOROOT/src/regexp&rdquo;ç›®å½•ä¸‹ç„¶åè¿è¡Œ&rdquo;go test -c&rdquo;ï¼Œç„¶åç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶&rdquo;regexp.test&rdquo;ã€‚</p>

<h3 id="å¼€å§‹">å¼€å§‹</h3>

<p>è¿è¡ŒGDBå¹¶è°ƒè¯•regexp.test:</p>

<pre><code>$ gdb regexp.test
GNU gdb (GDB) 7.2-gg8
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv  3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
Type &quot;show copying&quot; and &quot;show warranty&quot; for licensing/warranty details.
This GDB was configured as &quot;x86_64-linux&quot;.

Reading symbols from  /home/user/go/src/regexp/regexp.test...
done.
Loading Go Runtime support.
(gdb)
</code></pre>

<p>&ldquo;Loading Go Runtime support&rdquo;è¡¨ç¤ºGDBä»&rdquo;$GOROOT/src/runtime/runtime-gdb.py.&ldquo;åŠ è½½äº†æ‰©å±•è„šæœ¬ã€‚</p>

<p>é€šè¿‡ä¼ é€’&rdquo;-d&rdquo;å’Œ&rdquo;$GOROOT&rdquo;,å¯ä»¥ä½¿GDBæ‰¾åˆ°Goè¿è¡Œæ—¶ä»¥åŠå¯¹åº”çš„è„šæœ¬æ–‡ä»¶ã€‚</p>

<pre><code>$ gdb regexp.test -d $GOROOT
</code></pre>

<p>å¦‚æœå› ä¸ºä»€ä¹ˆåŸå› ï¼ŒGDBå§‹ç»ˆæ‰¾ä¸åˆ°è¿™ä¸ªç›®å½•å’Œè„šæœ¬ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨GDBé‡Œé¢æ¥åŠ è½½ã€‚ï¼ˆå‡è®¾ä½ çš„goæºç ä»£ç åœ¨&rdquo;~/go/&ldquo;ï¼‰</p>

<pre><code>(gdb) source ~/go/src/runtime/runtime-gdb.py
Loading Go Runtime support.
</code></pre>

<h3 id="æŸ¥çœ‹æºæ–‡ä»¶">æŸ¥çœ‹æºæ–‡ä»¶</h3>

<p>ä½¿ç”¨&rdquo;l&rdquo;æˆ–è€…&rdquo;list&rdquo;å‘½ä»¤æŸ¥çœ‹ä»£ç </p>

<pre><code>(gdb) l
</code></pre>

<p>é€šè¿‡ç»™&rdquo;list&rdquo;ä¼ é€’ä¸€ä¸ªå‡½æ•°åï¼ˆå¿…é¡»åŒ…å«åŒ…åï¼‰ï¼Œå¯ä»¥æŸ¥çœ‹æŒ‡å®šä½ç½®çš„æºä»£ç ã€‚</p>

<pre><code>(gdb) l main.main
</code></pre>

<p>æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çš„æŸè¡Œ</p>

<pre><code>(gdb) l regexp.go:1
(gdb) # Hit enter to repeat last command. Here, this lists next 10 lines.
</code></pre>

<h3 id="å‘½å">å‘½å</h3>

<p>å‡½æ•°åå’Œå˜é‡åå¿…é¡»è¦åŠ ä¸Šå…¶æ‰€åœ¨åŒ…çš„åŒ…åã€‚regexpåŒ…ä¸­çš„é¢å‡½æ•°&rdquo;Compile&rdquo;åœ¨GDBä¸­éœ€è¦å†™æˆ&rdquo;regexp.Compile&rdquo;ã€‚</p>

<p>æ–¹æ³•åå¿…é¡»è¦åŠ ä¸Šä»–çš„ç±»çš„ç±»å‹ã€‚æ¯”å¦‚&rdquo;* Regexp&rdquo;ç±»å‹çš„ &ldquo;String&rdquo; æ–¹æ³•è¦å†™æˆ &ldquo;regexp.(*Regexp).String&rdquo;ã€‚</p>

<p>è¢«å…¶ä»–å˜é‡éšè—çš„å˜é‡éœ€è¦åœ¨å…¶å‰é¢å¢åŠ ä¸€ä¸ªæ•°å­—ç´¢å¼•ï¼Œè€Œè¢«é—­åŒ…ğŸµçš„å˜é‡åˆ™éœ€è¦ç”¨æŒ‡é’ˆæ“ä½œç¬¦&rdquo;&amp;&ldquo;æ¥å‰ç¼€ã€‚</p>

<p>è®¾ç½®æ–­ç‚¹ï¼Œåœ¨&rdquo;TestFind&rdquo;å‡½æ•°å¤„è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼š</p>

<pre><code>(gdb) b 'regexp.TestFind'
Breakpoint 1 at 0x424908: file /home/user/go/src/regexp/find_test.go, line 148.
Run the program:

(gdb) run
Starting program: /home/user/go/src/regexp/regexp.test

Breakpoint 1, regexp.TestFind (t=0xf8404a89c0) at /home/user/go/src/regexp/find_test.go:148
148 func TestFind(t *testing.T) {
</code></pre>

<p>æ­¤æ—¶åœåœ¨æ–­ç‚¹å‡ºï¼Œå¯ä»¥æŸ¥çœ‹æ˜¯å“ªä¸ªgoroutinesåœ¨è¿è¡Œä»¥åŠåœ¨åšä»€ä¹ˆï¼š</p>

<pre><code>(gdb) info goroutines
1  waiting runtime.gosched
* 13  running runtime.goexit
</code></pre>

<p>&ldquo;*&rdquo; æ ‡è®°è¡¨ç¤ºå½“å‰åœ¨çš„goroutineã€‚</p>

<h3 id="æŸ¥çœ‹å †æ ˆ">æŸ¥çœ‹å †æ ˆ</h3>

<p>æŸ¥çœ‹æš‚åœæ—¶çš„å †æ ˆä¿¡æ¯ï¼š</p>

<pre><code>(gdb) bt  # backtrace
#0  regexp.TestFind (t=0xf8404a89c0) at /home/user/go/src/regexp/find_test.go:148
#1  0x000000000042f60b in testing.tRunner (t=0xf8404a89c0, test=0x573720) at /home/user/go/src/testing/testing.go:156
#2  0x000000000040df64 in runtime.initdone () at /home/user/go/src/runtime/proc.c:242
#3  0x000000f8404a89c0 in ?? ()
#4  0x0000000000573720 in ?? ()
#5  0x0000000000000000 in ?? ()
</code></pre>

<p>å¦ä¸€ä¸ªåºå·ä¸º1çš„çº¿ç¨‹åœåœ¨&rdquo;runtime.gosched&rdquo;çº¿ç¨‹ä¸­ï¼Œé˜»å¡äº†ä¸€ä¸ªchanelï¼š</p>

<pre><code>(gdb) goroutine 1 bt
#0  0x000000000040facb in runtime.gosched () at /home/user/go/src/runtime/proc.c:873
#1  0x00000000004031c9 in runtime.chanrecv (c=void, ep=void, selected=void, received=void)
at  /home/user/go/src/runtime/chan.c:342
#2  0x0000000000403299 in runtime.chanrecv1 (t=void, c=void) at/home/user/go/src/runtime/chan.c:423
#3  0x000000000043075b in testing.RunTests (matchString={void (struct string, struct string, bool *, error *)}
0x7ffff7f9ef60, tests=  []testing.InternalTest = {...}) at /home/user/go/src/testing/testing.go:201
#4  0x00000000004302b1 in testing.Main (matchString={void (struct string, struct string, bool *, error *)} 
0x7ffff7f9ef80, tests= []testing.InternalTest = {...}, benchmarks= []testing.InternalBenchmark = {...})
at /home/user/go/src/testing/testing.go:168
#5  0x0000000000400dc1 in main.main () at /home/user/go/src/regexp/_testmain.go:98
#6  0x00000000004022e7 in runtime.mainstart () at /home/user/go/src/runtime/amd64/asm.s:78
#7  0x000000000040ea6f in runtime.initdone () at /home/user/go/src/runtime/proc.c:243
#8  0x0000000000000000 in ?? ()
</code></pre>

<p>æ ˆå¸§æ˜¾ç¤ºæˆ‘ä»¬æ­£åœ¨æ‰§è¡Œ&rdquo;regexp.TestFind&rdquo;å‡½æ•°ï¼š</p>

<pre><code>(gdb) info frame
Stack level 0, frame at 0x7ffff7f9ff88:
 rip = 0x425530 in regexp.TestFind (/home/user/go/src/regexp/find_test.go:148); 
     saved rip 0x430233
called by frame at 0x7ffff7f9ffa8
source language minimal.
Arglist at 0x7ffff7f9ff78, args: t=0xf840688b60
Locals at 0x7ffff7f9ff78, Previous frame's sp is 0x7ffff7f9ff88
Saved registers:
 rip at 0x7ffff7f9ff80
</code></pre>

<p>å‘½ä»¤<code>info locals</code>åˆ—å‡ºäº†è¿™ä¸ªå‡½æ•°çš„æ‰€æœ‰çš„å±€éƒ¨å˜é‡å’Œå€¼ï¼Œå› ä¸ºå®ƒä¹Ÿä¼šæ‰“å°æœªç»åˆå§‹åŒ–çš„å˜é‡ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶ä¼šæœ‰ä¸€å®šçš„å±é™©ï¼Œå› ä¸ºæœªç»åˆå§‹åŒ–çš„sliceä¼šå¯¼è‡´gdbå»æ‰“å°ä»»æ„é•¿åº¦çš„æ•°ç»„ã€‚</p>

<p>å‡½æ•°å‚æ•°ï¼š</p>

<pre><code>(gdb) info args
t = 0xf840688b60
</code></pre>

<p>æ³¨æ„ï¼Œè¿™é‡Œæ‰“å°å‚æ•°æ—¶æ˜¯æ‰“å°çš„ä¸€ä¸ªRegexpçš„æŒ‡é’ˆã€‚GDBåœ¨ç±»å‹åçš„å³è¾¹æ”¾é‡ä¸€ä¸ª&rdquo;*&ldquo;æ¥ä¿®é¥°ä¸€ä¸ª&rdquo;struct&rdquo;ï¼Œè·Ÿä¼ ç»Ÿçš„Cé£æ ¼ä¸€æ ·ã€‚</p>

<pre><code>(gdb) p re
(gdb) p t
$1 = (struct testing.T *) 0xf840688b60
(gdb) p t
$1 = (struct testing.T *) 0xf840688b60
(gdb) p *t
$2 = {errors = &quot;&quot;, failed = false, ch = 0xf8406f5690}
(gdb) p *t-&gt;ch
$3 = struct hchan&lt;*testing.T&gt;
</code></pre>

<p>&ldquo;struct hchan&lt;*testing.T&gt;&ldquo;æ˜¯è¿è¡Œæ—¶å†…éƒ¨çš„channelçš„è¡¨ç¤ºï¼Œå½“å‰æ˜¯ç©ºçš„ï¼Œå¦åˆ™GDBä¼šæ‰“å°ä»–çš„å†…å®¹ã€‚</p>

<p>æ¥ç€å¾€ä¸‹èµ°ï¼š</p>

<pre><code>(gdb) n  # execute next line
149             for _, test := range findTests {
(gdb)    # enter is repeat
150                     re := MustCompile(test.pat)
(gdb) p test.pat
$4 = &quot;&quot;
(gdb) p re
$5 = (struct regexp.Regexp *) 0xf84068d070
(gdb) p *re
$6 = {expr = &quot;&quot;, prog = 0xf840688b80, prefix = &quot;&quot;, prefixBytes =  []uint8, prefixComplete = true, 
    prefixRune = 0, cond = 0 '\000', numSubexp = 0, longest = false, mu = {state = 0, sema = 0}, 
    machine =  []*regexp.machine}
(gdb) p *re-&gt;prog
$7 = {Inst =  []regexp/syntax.Inst = {{Op = 5 '\005', Out = 0, Arg = 0, Rune =  []int}, {Op = 
    6 '\006', Out = 2, Arg = 0, Rune =  []int}, {Op = 4 '\004', Out = 0, Arg = 0, Rune =  []int}}, 
    Start = 1, NumCap = 2}
</code></pre>

<p>é€šè¿‡&rdquo;s&rdquo;å¯ä»¥è¿›å…¥å¯¼å‡½æ•°&rdquo;String&rdquo;</p>

<pre><code>(gdb) s
regexp.(*Regexp).String (re=0xf84068d070, noname=void) at /home/user/go/src/regexp/regexp.go:97
97      func (re *Regexp) String() string {
</code></pre>

<p>çœ‹ä¸‹æ‰€åœ¨ä½ç½®çš„å †æ ˆ</p>

<pre><code>(gdb) bt
#0  regexp.(*Regexp).String (re=0xf84068d070, noname=void)
    at /home/user/go/src/regexp/regexp.go:97
#1  0x0000000000425615 in regexp.TestFind (t=0xf840688b60)
    at /home/user/go/src/regexp/find_test.go:151
#2  0x0000000000430233 in testing.tRunner (t=0xf840688b60, test=0x5747b8)
    at /home/user/go/src/testing/testing.go:156
#3  0x000000000040ea6f in runtime.initdone () at /home/user/go/src/runtime/proc.c:243
....
</code></pre>

<p>çœ‹ä»£ç ï¼š</p>

<pre><code>(gdb) l
92              mu      sync.Mutex
93              machine []*machine
94      }
95
96      // String returns the source text used to compile the regular expression.
97      func (re *Regexp) String() string {
98              return re.expr
99      }
100
101     // Compile parses a regular expression and returns, if successful,
</code></pre>

<h3 id="å®Œç¾æ‰“å°">å®Œç¾æ‰“å°</h3>

<p>GDBçš„å®Œç¾æ‰“å°æœºåˆ¶é€šè¿‡ regexpåŒ¹é…ç±»å‹åï¼Œæ¯”å¦‚slices:</p>

<pre><code>(gdb) p utf
$22 =  []uint8 = {0 '\000', 0 '\000', 0 '\000', 0 '\000'}
</code></pre>

<p>slices/arrayä»¥åŠstringsçš„åˆ‡ç‰‡ä¸æ˜¯CæŒ‡é’ˆã€‚GDBä¸èƒ½ä¸ºä½ æ“ä½œå­è„šæœ¬ï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹è¿è¡Œæ—¶å†…éƒ¨çš„åç§°è¡¨ç¤ºæ¥æŸ¥çœ‹ï¼ˆé€šè¿‡TABè‡ªåŠ¨è¡¥å…¨ï¼‰</p>

<pre><code>(gdb) p slc
$11 =  []int = {0, 0}
(gdb) p slc-&gt;&lt;TAB&gt;
array  slc    len    
(gdb) p slc-&gt;array
$12 = (int *) 0xf84057af00
(gdb) p slc-&gt;array[1]
$13 = 0
</code></pre>

<p>æ‰©å±•å‡½æ•°&rdquo;$len&rdquo;å’Œ&rdquo;$cap&rdquo;å¯ä»¥ä½œç”¨åœ¨strings/arrayså’Œsclices:</p>

<pre><code>(gdb) p $len(utf)
$23 = 4
(gdb) p $cap(utf)
$24 = 4
</code></pre>

<p>Channelså’ŒMapsæ˜¯å¼•ç”¨ç±»å‹ï¼ŒGDBä¼šæŒ‰ç…§C++æ ¼å¼çš„æŒ‡é’ˆè¿›è¡Œæ‰“å°å¦‚â€œhash<int,string>*â€ã€‚è§£å¼•ç”¨ä¹Ÿå¯ä»¥å®Œç¾æ”¯æŒã€‚</p>

<p>å¼•ç”¨åœ¨è¿è¡Œæ—¶é‡Œé¢è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªæ‰§è¡Œç±»å‹çš„æŒ‡é’ˆå’Œä¸€ä¸ªæ‰§è¡Œå€¼çš„æŒ‡é’ˆã€‚Goçš„GDBæ‰©å±•ä¼šè‡ªåŠ¨å°†è¿™ä¸¤è€…è§£ç å¹¶åœ¨è¿›è¡Œæ‰“å°ã€‚æ‰©å±•å‡½æ•°&rdquo;$dtype&rdquo;å°†è§£ç åŠ¨æ€ç±»å‹ï¼ˆæ¯”å¦‚ä¾‹å­ä¸­çš„regexp.goçš„293è¡Œï¼‰</p>

<pre><code>(gdb) p i
$4 = {str = &quot;cbb&quot;}
(gdb) whatis i
type = regexp.input
(gdb) p $dtype(i)
$26 = (struct regexp.inputBytes *) 0xf8400b4930
(gdb) iface i
regexp.input: struct regexp.inputBytes *
</code></pre>
</div>
            <div class="footer">
                



            </div>
        </div>
        
                
    </body>
</html>
